# 要件定義書: Ctrl + Enter 送信 Chrome 拡張

## 1. 目的
ChatGPT、Gemini、Google Chat において、送信操作を `Ctrl + Enter` に統一し、通常の `Enter` は改行として扱えるようにする。

## 2. 背景
複数のチャットサービスで送信キーが異なると、誤送信や入力ミスが起こりやすい。統一したショートカットで送信できる拡張を提供し、作業効率と安全性を高める。

## 3. 対象範囲
### 対象サイト
- ChatGPT (例: https://chat.openai.com/)
- Gemini (https://gemini.google.com/)
- Google Chat (https://chat.google.com/)

### 対象外
- 上記以外のサイト
- Gmail など Google Chat 以外の Google サービス

## 4. ユースケース
- ユーザーは各サービスの入力欄で通常の `Enter` を押して改行できる。
- ユーザーは `Ctrl + Enter` で送信できる。
- UI の更新や動的要素の再描画後も動作する。

## 5. 機能要件
### 5.1 共通
- `Enter` は改行として動作する。
- `Ctrl + Enter` で送信する。
- Mac 環境でも `Ctrl + Enter` を送信とする。
- 対象サイトの入力欄以外ではキー操作を変更しない。
- サイト固有の送信ボタンをクリックする方法で送信する。
 - 各サイトごとに機能の ON/OFF を切り替えられる。
 - 機能 OFF のサイトでは、拡張が存在しない状態と同じ挙動にする。

### 5.2 ChatGPT
- ChatGPT の入力欄（contenteditable / textarea）に対してキー制御を行う。
- 動的な DOM 更新に対応する。

### 5.3 Gemini
- Gemini の入力欄（rich-textarea など）に対してキー制御を行う。
- 編集モードなど複数の入力欄に対応する。
- Gem マネージャーに検索バーを追加する。
- Gem 検索は名前と説明文に対して部分一致で絞り込む。
- Gem 検索は jsmigemo によりローマ字入力でも検索可能にする。

### 5.4 Google Chat
- Google Chat の入力欄（div/textarea 両方に対応）に対してキー制御を行う。
- iframe 内での入力欄にも対応可能にする（必要に応じて `all_frames` を利用）。

## 6. 非機能要件
- Manifest V3 で実装する。
- 拡張は簡易な GUI（ポップアップ）で ON/OFF を切り替えられる。
- 権限は最小限（対象サイトの `host_permissions` のみ）。
- パフォーマンスに配慮し、監視は必要最小限の `MutationObserver` で行う。

## 7. UI/UX 要件
- ブラウザの拡張アイコンから開くポップアップに ON/OFF の切り替えを用意する。
- Gemini の Gem 検索機能もポップアップから ON/OFF できる。
- 既存のショートカットや標準動作を破壊しない。

## 8. 制約
- 対象サイトの DOM 構造が変更された場合、セレクタの更新が必要となる。
- 送信ボタンが存在しない状態（読み込み中など）では送信処理を行わない。

## 9. 受け入れ基準
### 9.1 共通
- 対象サイトで `Enter` を押すと改行になる。
- 対象サイトで `Ctrl + Enter` を押すと送信される（Mac でも同様）。
- 対象サイト以外ではキー挙動が変わらない。

### 9.2 ChatGPT
- 入力欄で `Ctrl + Enter` が送信として動作する。
- ページ遷移やリロード後も動作する。

### 9.3 Gemini
- 入力欄で `Ctrl + Enter` が送信として動作する。
- 編集モードなど入力欄が切り替わった場合も動作する。
- Gem マネージャーで検索バーが表示される。
- Gem の名前・説明文に対する検索で絞り込める。
- ローマ字入力でも Gem を絞り込める。

### 9.4 Google Chat
- 入力欄で `Ctrl + Enter` が送信として動作する。
- iframe 内の入力欄でも動作する（該当する UI で確認する）。

## 10. テスト観点 (受け入れ確認の補助)
- Windows と Mac で `Ctrl + Enter` 送信が期待通り動作する。
- 入力欄以外（検索欄など）で Enter の挙動が変わらない。
- 送信直後にエラーやフリーズが発生しない。
